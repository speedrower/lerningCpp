#include <iostream>

// ---------------- Function Declarations ----------------
void initMenuBox();
void menuDecision();
double calculate(char operation, double a, double b);
double getNumber();
int getInt();
double add(double, double);
double subtract(double, double);
double multiply(double, double);
double divide(double, double);
double power(double, int);
void clearScreen();

// ---------------- Main ----------------
int main() {
    char choice = 'y';

    do {
        clearScreen();
        initMenuBox();
        menuDecision();

        do {
            std::cout << "\nDo you want to continue? (Y/N): ";
            std::cin >> choice;
            std::cin.ignore(1024, '\n');
        } while (choice != 'y' && choice != 'Y' && choice != 'n' && choice != 'N');

    } while (choice == 'y' || choice == 'Y');

    std::cout << "\nThank you for using the calculator.\n";
    return 0;
}

// ---------------- Menu ----------------
void initMenuBox() {
    std::cout << "-------------------------------------\n";
    std::cout << "|        Calculator v1.0             |\n";
    std::cout << "-------------------------------------\n\n";
    std::cout << "Choose an operation:\n";
    std::cout << "+  Addition\n";
    std::cout << "-  Subtraction\n";
    std::cout << "*  Multiplication\n";
    std::cout << "/  Division\n";
    std::cout << "^  Power (integer exponent)\n\n";
}

// ---------------- MenuDecision ----------------
void menuDecision() {
    char operation;
    std::cout << "Enter operation: ";

    while (!(std::cin >> operation) ||
        (operation != '+' && operation != '-' && operation != '*' &&
         operation != '/' && operation != '^')) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Enter a valid operation: ";
    }

    std::cout << "Enter first number: ";
    double a = getNumber();

    double b;
    if (operation == '^') {
        std::cout << "Enter exponent (integer): ";
        b = getInt();
    } else {
        std::cout << "Enter second number: ";
        b = getNumber();
    }

    double result = calculate(operation, a, b);

    std::cout << "\nResult: " << a << " " << operation << " " << b
              << " = " << result << "\n";
}

double calculate(char operation, double a, double b) {
    switch (operation) {
    case '+':
        return add(a, b);
    case '-':
        return subtract(a, b);
    case '*':
        return multiply(a, b);
    case '/':
        return divide(a, b);
    case '^':
        return power(a, b);
    default:
        std::cout << "Unknown operation.\n";
        return 0.0;
    }
}

// ---------------- Input Handling ----------------
double getNumber() {
    double num;
    while (!(std::cin >> num)) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Try again: ";
    }
    return num;
}

int getInt() {
    int num;
    while (!(std::cin >> num)) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Try again: ";
    }
    return num;
}

// ---------------- Operations ----------------
double add(double a, double b) {
    return a + b;
}

double subtract(double a, double b) {
    return a - b;
}

double multiply(double a, double b) {
    return a * b;
}

double divide(double a, double b) {
    while (b == 0) {
        std::cout << "Error: division by zero!\n";
        b = getNumber();
    }
    return a / b;
}

double power(double a, int b) {
    double result = 1;
    if (b < 0) {
        a = 1 / a;
        b = -b;
    }
    while (b--)
        result *= a;

    return result;
}

void clearScreen() {
    std::cout << "\033[2J\033[H";
}
