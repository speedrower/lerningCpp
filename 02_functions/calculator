#include <iostream>

// ---------------- Function Declarations ----------------
void initMenuBox();
void menuDecision();
double getNumber();
int getInt();
double add(double, double);
double subtract(double, double);
double multiply(double, double);
double divide(double, double);
double power(double, int);
void clearScreen();

// ---------------- Main ----------------
int main() {
    char choice = 'y';

    do {
        clearScreen();
        initMenuBox();
        menuDecision();

        do {
            std::cout << "\nDo you want to continue? (Y/N): ";
            std::cin >> choice;
            std::cin.ignore(1024, '\n');
        } while (choice != 'y' && choice != 'Y' && choice != 'n' && choice != 'N');

    } while (choice == 'y' || choice == 'Y');

    std::cout << "\nThank you for using the calculator.\n";
    return 0;
}

// ---------------- Menu ----------------
void initMenuBox() {
    std::cout << "-------------------------------------\n";
    std::cout << "|           Calculator v1.0         |\n";
    std::cout << "|             Filip Bak              |\n";
    std::cout << "-------------------------------------\n\n";
    std::cout << "Choose an operation:\n";
    std::cout << "+  Addition\n";
    std::cout << "-  Subtraction\n";
    std::cout << "*  Multiplication\n";
    std::cout << "/  Division\n";
    std::cout << "^  Power (integer exponent)\n\n";
}

// ---------------- MenuDecision ----------------
void menuDecision() {
    char operation;
    std::cout << "Enter operation: ";
    while (!(std::cin >> operation) || (operation != '+' && operation != '-' && operation != '*' && operation != '/' && operation != '^')) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Enter a valid operation: ";
    }

    double a = getNumber();

    if (operation == '^') {
        int exponent = getInt();
        std::cout << "\nResult: " << a << " ^ " << exponent << " = " << power(a, exponent) << "\n";
    }
    else {
        double b;
        if (operation == '/') {
            do {
                b = getNumber();
                if (b == 0)
                    std::cout << "Error: division by zero!\n";
            } while (b == 0);
        }
        else {
            b = getNumber();
        }

        double result;
        switch (operation) {
        case '+': 
            result = add(a, b); 
            break;
        case '-': 
            result = subtract(a, b); 
            break;
        case '*': 
            result = multiply(a, b); 
            break;
        case '/': 
            result = divide(a, b); 
            break;
        }

        std::cout << "\nResult: " << a << " " << operation << " " << b << " = " << result << "\n";
    }
}

// ---------------- Input Functions ----------------
double getNumber() {
    double num;
    std::cout << "Enter a number: ";
    while (!(std::cin >> num)) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Try again: ";
    }
    return num;
}

int getInt() {
    int num;
    std::cout << "Enter an integer: ";
    while (!(std::cin >> num)) {
        std::cin.clear();
        std::cin.ignore(1024, '\n');
        std::cout << "Error. Try again: ";
    }
    return num;
}

// ---------------- Operations ----------------
double add(double a, double b) { 
    return a + b; 
}

double subtract(double a, double b) { 
    return a - b; 
}

double multiply(double a, double b) { 
    return a * b; 
}

double divide(double a, double b) { 
    return a / b; 
}

double power(double a, int b) {
    double result = 1;
    if (b < 0) {
        a = 1 / a;
        b = -b;
    }
    while (b--) result *= a;
    return result;
}

void clearScreen() { 
    std::cout << "\033[2J\033[H"; 
}
